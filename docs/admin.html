<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin — Igreja Assembleia</title>

  <!-- CSS -->
  <link rel="stylesheet" href="assets/css/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- JS (ordem importa) -->
  <script src="assets/js/config.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="assets/js/supabaseClient.js"></script>
  <script src="assets/js/api.js"></script>
  <script src="assets/js/ui.js"></script>
  <script src="assets/js/main-admin.js" defer></script>
</head>
<body>
  <header>
    <div class="container header-content">
      <div class="logo"><i class="fas fa-church"></i><span>Admin – Igreja Assembleia</span></div>
      <nav>
        <ul>
          <li><a href="index.html">Início</a></li>
          <li><a href="cultos.html">Cultos</a></li>
          <li><a href="eventos.html">Eventos</a></li>
          <li><a href="sermoes.html">Pregações</a></li>
          <li><a href="admin.html" class="active">Admin</a></li>
        </ul>
      </nav>
      <div class="mobile-menu-btn"><i class="fas fa-bars"></i></div>
    </div>
  </header>

  <main class="container" style="margin-top:100px">
    <!-- Login -->
    <section id="loginSection">
      <h2>Login administrativo</h2>
      <p class="muted">Entre com e-mail e senha criados no Supabase (Authentication → Users). Esse e-mail deve existir também na tabela <code>admins</code> com <code>is_active = true</code>.</p>
      <div class="form-group"><input id="admin_email" type="email" placeholder="E-mail" autocomplete="username"/></div>
      <div class="form-group"><input id="admin_password" type="password" placeholder="Senha" autocomplete="current-password"/></div>
      <button id="btnLogin" class="btn"><i class="fas fa-right-to-bracket"></i> Entrar</button>
    </section>

    <!-- Painel -->
    <section id="panelSection" style="display:none">
      <div style="display:flex; gap:10px; align-items:center; margin-bottom:12px;">
        <button id="tabRegs" class="admin-tab active">Inscrições</button>
        <button id="tabDon" class="admin-tab">Doações</button>
        <button id="tabEv"  class="admin-tab">Eventos</button>
        <div style="margin-left:auto; display:flex; gap:8px;">
          <button id="btnRefresh" class="btn btn-outline"><i class="fas fa-rotate"></i> Atualizar</button>
          <button id="btnLogout"  class="btn btn-outline"><i class="fas fa-right-from-bracket"></i> Sair</button>
        </div>
      </div>

      <!-- Inscrições -->
      <div id="tabRegsContent" class="admin-tab-content active">
        <div class="admin-section">
          <h3>Inscrições em eventos</h3>
          <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
            <select id="filterEvent" style="padding:8px; border:1px solid #e2e8f0; border-radius:6px;">
              <option value="">Todos os eventos</option>
            </select>
            <input id="searchReg" type="search" placeholder="Buscar por nome, e-mail…" style="flex:1; min-width:220px; padding:8px; border:1px solid #e2e8f0; border-radius:6px;">
            <button id="btnExportCSV" class="export-btn"><i class="fas fa-file-csv"></i> Exportar CSV</button>
          </div>
        </div>

        <div id="regsStats" class="stats-grid" style="margin-top:10px;"></div>
        <div id="regsList" style="margin-top:10px;"></div>
      </div>

      <!-- Doações -->
      <div id="tabDonContent" class="admin-tab-content">
        <h3>Doações</h3>
        <div id="donList"></div>
      </div>

      <!-- Eventos (gerenciar) -->
      <div id="tabEvContent" class="admin-tab-content">
        <h3>Novo evento</h3>
        <form id="evForm" style="display:grid; gap:10px; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); align-items:end;">
          <div>
            <label class="muted" for="ev_title">Título</label>
            <input id="ev_title" type="text" placeholder="Título do evento" required>
          </div>
          <div>
            <label class="muted" for="ev_date">Data</label>
            <input id="ev_date" type="date" required>
          </div>
          <div>
            <label class="muted" for="ev_time">Início</label>
            <input id="ev_time" type="time">
          </div>
          <div>
            <label class="muted" for="ev_end_time">Fim</label>
            <input id="ev_end_time" type="time">
          </div>
          <div>
            <label class="muted" for="ev_location">Local</label>
            <input id="ev_location" type="text" placeholder="Local">
          </div>
          <div style="grid-column: 1/-1;">
            <label class="muted" for="ev_desc">Descrição</label>
            <textarea id="ev_desc" rows="2" placeholder="Descrição (opcional)"></textarea>
          </div>
          <div>
            <label class="muted" for="ev_deadline">Prazo de inscrição</label>
            <input id="ev_deadline" type="date">
          </div>
          <div>
            <label class="muted" for="ev_max">Vagas (máx.)</label>
            <input id="ev_max" type="number" min="1" step="1" placeholder="ex.: 100">
          </div>
          <div style="display:flex; align-items:center; gap:8px;">
            <input id="ev_requires_reg" type="checkbox">
            <label for="ev_requires_reg">Requer inscrição</label>
          </div>
          <div style="display:flex; align-items:center; gap:8px;">
            <input id="ev_active" type="checkbox" checked>
            <label for="ev_active">Ativo</label>
          </div>
          <div style="grid-column: 1/-1; display:flex; justify-content:flex-end;">
            <button type="submit" class="btn"><i class="fas fa-plus"></i> Criar evento</button>
          </div>
        </form>

        <h3 style="margin-top:16px;">Eventos cadastrados</h3>
        <div id="evList" style="margin-top:10px;"></div>
      </div>
    </section>
  </main>
</body>
</html>
